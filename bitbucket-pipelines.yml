image: node:22

definitions:
  services:
    docker:
      memory: 3072
  caches:
    corepack-cache: $HOME/.cache/node/corepack
  steps:
    - step: &install
        name: ⚙️ Install
        caches:
          - corepack-cache
        script:
          - corepack enable yarn
          - yarn install --immutable
        artifacts:
          - node_modules/**
    - step: &lint
        name: 🧹 Lint
        caches:
          - corepack-cache
        script:
          - corepack enable yarn
          - yarn run lint
    - step: &typecheck
        name: 🔍 Typecheck
        caches:
          - corepack-cache
        script:
          - corepack enable yarn
          - yarn run typecheck
    - step: &test
        name: 🧪 Test
        caches:
          - corepack-cache
        script:
          - corepack enable yarn
          - yarn run test

pipelines:
  pull-requests:
    '**':
      - step: *install
      - parallel:
          steps:
            - step: *lint
            - step: *typecheck
            - step: *test